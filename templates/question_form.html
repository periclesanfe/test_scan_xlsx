{% extends "base.html" %}
{% block title %}{{ 'Editar' if question else 'Nova' }} Pergunta – QuizScan{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header bg-white fw-semibold">
        <i class="bi bi-question-circle"></i> {{ 'Editar Pergunta' if question else 'Nova Pergunta' }}
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label class="form-label fw-semibold" for="question_text">Texto da Pergunta *</label>
            <textarea id="question_text" class="form-control" name="text" rows="3" required>{{ question.text if question else '' }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold" for="answer_type">Tipo de Resposta *</label>
            <select class="form-select" name="answer_type" id="answer_type" required>
              <option value="yes_no" {% if question and question.answer_type=='yes_no' %}selected{% endif %}>Sim / Não</option>
              <option value="likert" {% if question and question.answer_type=='likert' %}selected{% endif %}>Escala Likert (1–5)</option>
              <option value="custom" {% if question and question.answer_type=='custom' %}selected{% endif %}>Personalizada</option>
            </select>
          </div>
          <div class="mb-3" id="custom_options_group" style="display:none">
            <label class="form-label fw-semibold" for="custom_options">Opções Personalizadas (separadas por vírgula)</label>
            <input id="custom_options" type="text" class="form-control" name="custom_options"
                   placeholder="ex: Ruim, Regular, Bom, Excelente"
                   value="{{ question.custom_options if question else '' }}">
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold" for="correct_answer">Resposta Correta</label>
            <input id="correct_answer" type="text" class="form-control" name="correct_answer"
                   placeholder="Deixe em branco se não houver resposta certa"
                   value="{{ question.correct_answer if question else '' }}">
            <div class="form-text">
              Para Sim/Não use: <code>Sim</code> ou <code>Não</code>. Para Likert use: <code>1</code>–<code>5</code>. Para personalizada use exatamente uma das opções acima.
            </div>
          </div>
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">{{ 'Salvar Alterações' if question else 'Criar Pergunta' }}</button>
            <a href="{{ url_for('questions_list') }}" class="btn btn-outline-secondary">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
const sel = document.getElementById('answer_type');
const customGrp = document.getElementById('custom_options_group');
function toggle() { customGrp.style.display = sel.value === 'custom' ? 'block' : 'none'; }
sel.addEventListener('change', toggle);
toggle();
</script>
{% endblock %}
