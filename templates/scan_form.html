{% extends "base.html" %}
{% block title %}Novo Scan – {{ test.title }}{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">
    <div class="card">
      <div class="card-header bg-white fw-semibold">
        <i class="bi bi-upc-scan"></i> Registrar Scan – {{ test.title }}
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label fw-semibold" for="respondent_name">Nome do Respondente *</label>
              <input id="respondent_name" type="text" class="form-control" name="respondent_name" autocomplete="name" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold" for="observation">Observação / Descrição</label>
              <input id="observation" type="text" class="form-control" name="observation">
            </div>
            <div class="col-12">
              <label class="form-label fw-semibold" for="scan_image">Foto / Scan da Prova <span class="text-muted small">(opcional – PNG, JPG, etc.)</span></label>
              <input id="scan_image" type="file" class="form-control" name="image" accept="image/*,.pdf">
              <div class="form-text">Se enviada, o sistema tentará detectar automaticamente as marcações via OMR. Você pode também preencher manualmente abaixo.</div>
            </div>
          </div>

          <h6 class="fw-semibold mb-3">Respostas</h6>
          {% for tq in test.questions %}
          {% set q = tq.question %}
          <div class="mb-4 p-3 border rounded">
            <p class="mb-2 fw-semibold">{{ loop.index }}. {{ q.text }}</p>
            <div class="d-flex flex-wrap gap-3">
              {% for opt in q.get_options() %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ q.id }}" id="q{{ q.id }}_{{ loop.index }}" value="{{ opt }}">
                <label class="form-check-label" for="q{{ q.id }}_{{ loop.index }}">{{ opt }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endfor %}

          <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle"></i> Registrar</button>
            <a href="{{ url_for('scans_list', tid=test.id) }}" class="btn btn-outline-secondary">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
